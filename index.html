<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shader Recorder for Yewon</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Consolas', 'Monaco', monospace;
    }

    #shader-code {
      font-family: 'Consolas', 'Monaco', monospace;
    }

    .custom-scrollbar::-webkit-scrollbar {
      width: 8px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: #1e1e1e;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #3c3c3c;
      border-radius: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #4c4c4c;
    }
  </style>
</head>

<body class="bg-[#1e1e1e] text-[#d4d4d4] overflow-hidden">
  <div id="container" class="flex h-screen">
    <!-- Editor Panel -->
    <div id="editor-panel" class="w-1/2 flex flex-col border-r border-[#333]">
      <div id="editor-container" class="flex-1 flex flex-col min-h-0">
        <!-- Controls -->
        <div id="controls"
          class="bg-[#252526] p-2.5 border-b border-[#333] flex flex-col gap-2.5 max-h-[50vh] overflow-y-auto custom-scrollbar">
          <!-- Compile & Grid Toggle -->
          <div class="flex items-center gap-2 flex-wrap">
            <button id="compile-btn" class="bg-[#0e639c] hover:bg-[#1177bb] text-white px-4 py-2 rounded text-sm">컴파일
              (Ctrl+Enter)</button>
            <button id="reset-btn" class="bg-[#0e639c] hover:bg-[#1177bb] text-white px-4 py-2 rounded text-sm">시간
              리셋</button>
            <button id="toggle-grid-btn"
              class="bg-[#0e639c] hover:bg-[#1177bb] text-white px-4 py-2 rounded text-sm">그리드 모드</button>
          </div>

          <!-- Resolution -->
          <div class="flex items-center gap-2 flex-wrap">
            <label class="text-sm">해상도:</label>
            <input type="number" id="width" value="1920" min="256" max="7680"
              class="bg-[#3c3c3c] text-[#d4d4d4] border border-[#555] px-2.5 py-1.5 rounded text-sm w-20">
            <span>×</span>
            <input type="number" id="height" value="1080" min="256" max="4320"
              class="bg-[#3c3c3c] text-[#d4d4d4] border border-[#555] px-2.5 py-1.5 rounded text-sm w-20">
            <button id="apply-res-btn"
              class="bg-[#0e639c] hover:bg-[#1177bb] text-white px-4 py-2 rounded text-sm">적용</button>
          </div>

          <!-- FPS & Bitrate -->
          <div class="flex items-center gap-2 flex-wrap">
            <label class="text-sm">FPS:</label>
            <select id="fps" class="bg-[#3c3c3c] text-[#d4d4d4] border border-[#555] px-2.5 py-1.5 rounded text-sm">
              <option value="30">30</option>
              <option value="60" selected>60</option>
              <option value="120">120</option>
            </select>
            <label class="text-sm ml-4">비트레이트:</label>
            <select id="bitrate" class="bg-[#3c3c3c] text-[#d4d4d4] border border-[#555] px-2.5 py-1.5 rounded text-sm">
              <option value="25000000">25 Mbps</option>
              <option value="50000000" selected>50 Mbps</option>
              <option value="75000000">75 Mbps</option>
              <option value="100000000">100 Mbps</option>
            </select>
          </div>

          <!-- Grid Settings -->
          <div id="grid-settings" class="hidden bg-[#2d2d30] border border-[#3c3c3c] rounded p-2.5 mt-1">
            <div class="flex items-center gap-2 mb-2">
              <label class="text-sm">그리드:</label>
              <input type="number" id="grid-cols" value="3" min="1" max="10"
                class="bg-[#3c3c3c] text-[#d4d4d4] border border-[#555] px-2 py-1 rounded text-sm w-16">
              <span>×</span>
              <input type="number" id="grid-rows" value="3" min="1" max="10"
                class="bg-[#3c3c3c] text-[#d4d4d4] border border-[#555] px-2 py-1 rounded text-sm w-16">
            </div>
            <div class="flex items-center gap-2 mb-2">
              <label class="text-sm">루프 길이:</label>
              <input type="number" id="loop-duration" value="3" min="0.1" max="60" step="0.1"
                class="bg-[#3c3c3c] text-[#d4d4d4] border border-[#555] px-2 py-1 rounded text-sm w-20">
              <span class="text-sm">초</span>
            </div>
            <div class="flex items-center gap-2 mb-2">
              <label class="text-sm">재생 속도:</label>
              <input type="number" id="playback-speed" value="1.0" min="0.1" max="5.0" step="0.1"
                class="bg-[#3c3c3c] text-[#d4d4d4] border border-[#555] px-2 py-1 rounded text-sm w-20">
              <span class="text-sm">×</span>
            </div>
            <div class="flex items-center gap-2 mb-2">
              <label class="text-sm">루프 모드:</label>
              <select id="loop-mode" class="bg-[#3c3c3c] text-[#d4d4d4] border border-[#555] px-2 py-1 rounded text-sm">
                <option value="pingpong">핑퐁 (왕복)</option>
                <option value="repeat">반복</option>
              </select>
            </div>
            <div class="flex items-center gap-2 mb-2">
              <label class="text-sm">시간 오프셋:</label>
              <select id="offset-mode"
                class="bg-[#3c3c3c] text-[#d4d4d4] border border-[#555] px-2 py-1 rounded text-sm">
                <option value="random">랜덤</option>
                <option value="sequential">순차적</option>
                <option value="manual">수동</option>
                <option value="none">없음</option>
              </select>
            </div>
            <div class="flex items-center gap-2">
              <button id="regenerate-offsets-btn"
                class="bg-[#0e639c] hover:bg-[#1177bb] text-white px-3 py-1 rounded text-sm">오프셋 재생성</button>
            </div>

            <!-- Cell Time Offsets -->
            <div id="cell-offsets-container"
              class="hidden mt-2 p-2 bg-[#1e1e1e] rounded max-h-[300px] overflow-y-auto custom-scrollbar">
              <div class="text-xs text-[#4ec9b0] font-bold mb-2">각 셀 시간 오프셋 (초)</div>
              <div id="cell-offsets-grid" class="grid gap-1.5"></div>
            </div>
          </div>

          <!-- Recording -->
          <div class="flex items-center gap-2 flex-wrap">
            <label class="text-sm">녹화 시작:</label>
            <input type="number" id="record-start" value="0" min="0" step="0.1"
              class="bg-[#3c3c3c] text-[#d4d4d4] border border-[#555] px-2 py-1 rounded text-sm w-20">
            <span class="text-sm">초</span>
            <label class="text-sm ml-4">녹화 길이:</label>
            <input type="number" id="record-duration" value="10" min="0.1" step="0.1"
              class="bg-[#3c3c3c] text-[#d4d4d4] border border-[#555] px-2 py-1 rounded text-sm w-20">
            <span class="text-sm">초</span>
            <label class="text-sm ml-2 flex items-center gap-1">
              <input type="checkbox" id="auto-stop" checked>
              자동 중지
            </label>
          </div>

          <div class="flex items-center gap-2 flex-wrap">
            <button id="record-btn" class="bg-[#0e639c] hover:bg-[#1177bb] text-white px-4 py-2 rounded text-sm">녹화
              시작</button>
            <button id="record-reset-btn"
              class="bg-[#0e639c] hover:bg-[#1177bb] text-white px-4 py-2 rounded text-sm">0초부터 녹화</button>
            <button id="download-btn"
              class="hidden bg-[#0e639c] hover:bg-[#1177bb] text-white px-4 py-2 rounded text-sm">다운로드</button>
            <span id="record-status" class="text-xs text-gray-400 ml-2"></span>
          </div>
        </div>

        <!-- Shader Code Editor -->
        <textarea id="shader-code" spellcheck="false"
          class="flex-1 bg-[#1e1e1e] text-[#d4d4d4] border-0 p-4 text-sm leading-relaxed resize-none outline-none">// WebGL 2.0 GLSL 300 es

#pragma param speed 0.0 5.0 1.0 0.1
#pragma param radius 0.1 1.0 0.5 0.01
#pragma param intensity 0.0 2.0 1.0 0.05

void mainImage(out vec4 fragColor, in vec2 fragCoord) {
    vec2 uv = fragCoord / iResolution.xy;
    vec2 p = (2.0 * fragCoord - iResolution.xy) / iResolution.y;
    
    vec3 col = 0.5 + 0.5 * cos(iTime * speed + uv.xyx + vec3(0, 2, 4));
    
    float d = length(p) - radius;
    d = sin(d * 8.0 + iTime * speed) / 8.0;
    d = abs(d);
    d = 0.02 / d;
    col *= d * intensity;
    
    fragColor = vec4(col, 1.0);
}</textarea>
      </div>

      <!-- Shader Cards -->
      <div id="cards-container"
        class="bg-[#252526] border-t border-[#333] py-3 overflow-x-auto overflow-y-hidden whitespace-nowrap">
        <div id="cards-slider" class="inline-flex gap-3 px-3"></div>
      </div>
    </div>

    <!-- Viewer Panel -->
    <div id="viewer-panel" class="w-1/2 flex flex-col bg-[#2d2d30]">
      <!-- Preview Section (상단 40%) -->
      <div class="h-2/5 p-4 flex items-center justify-center relative border-b border-[#333]">
        <div id="canvas-container" class="w-full h-full flex items-center justify-center">
          <canvas id="canvas" class="max-w-full max-h-full object-contain"></canvas>
          <canvas id="grid-canvas" class="max-w-full max-h-full object-contain hidden"></canvas>
        </div>

        <!-- Info Panel -->
        <div id="info" class="absolute top-2.5 left-2.5 bg-black/70 px-3 py-2 rounded text-xs">
          <div>모드: <span id="mode-info">단일</span></div>
          <div>FPS: <span id="fps-counter">0</span></div>
          <div>시간: <span id="time-counter">0.00</span>s</div>
          <div>해상도: <span id="resolution-info">1920×1080</span></div>
        </div>

        <!-- Error Panel -->
        <div id="error"
          class="hidden absolute bottom-2.5 left-2.5 right-2.5 bg-red-600/90 text-white p-3 rounded text-xs max-h-[150px] overflow-y-auto custom-scrollbar">
        </div>
      </div>

      <!-- Parameters Section (하단 60%) -->
      <div class="h-3/5 bg-[#252526] overflow-y-auto custom-scrollbar">
        <div id="params-panel" class="p-4">
          <div class="flex justify-between items-center mb-3 pb-2 border-b border-[#3c3c3c]">
            <span class="text-sm font-bold text-[#4ec9b0]">쉐이더 파라미터</span>
            <button class="params-toggle bg-[#3c3c3c] hover:bg-[#4c4c4c] text-[#d4d4d4] px-2 py-1 rounded text-xs"
              onclick="toggleParamsPanel()">−</button>
          </div>
          <div id="params-content">
            <div class="text-xs text-gray-400 text-center py-8">파라미터가 없습니다</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="shader-viewer.js"></script>
</body>

</html>